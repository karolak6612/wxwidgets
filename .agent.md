# RME-Qt6 Migration Project - Developer Guide

## Project Overview

This project is migrating **Remere's Map Editor (RME)**, a 2D tile map editor for OTBM maps, from its original C++/wxWidgets codebase to a modernized C++/Qt6 application.

### Key Information
- **Language**: C++17 with Qt6 framework
- **Original Source**: wxWidgets-based application in `wxwidgets/` directory
- **Target Platform**: Qt6 application in `Project_QT/src/` directory
- **Styling**: Uses Qlementine Qt styling library for modern UI
- **Build System**: CMake with cross-platform support (Windows, macOS, Linux)
- **License**: GNU GPL v3 (original), MIT (Qlementine dependency)

## Project Structure

### Core Directories
- **`Project_QT/`** - Main Qt6 application code
  - `src/core/` - Core data structures and logic
  - `src/editor_logic/` - Editor controller and commands
  - `src/ui/` - User interface components
  - `src/tests/` - Unit tests using Qt Test framework
- **`wxwidgets/`** - Original wxWidgets source code (reference only)
- **`qlementine/`** - Modern Qt styling library (submodule/dependency)
- **`enhanced_wbs_yaml_files/`** - Task definitions for migration work
- **`XML/`** - Configuration and data files (items, creatures, materials)

### Key Files
- **`MASTER_PROJECT_PROMPT.md`** - Primary project documentation and workflow
- **`tasks_execution_order.md`** - Dependency-ordered task execution plan
- **`functionality_index.yaml`** - Maps original features to source files
- **`dependency_manifest.yaml`** - External library dependencies
- **`qlementine_documentation.yaml`** - Qlementine integration guide

## Architecture & Design Patterns

### Core Data Structures
- **Position** (`core/Position.h`) - 3D coordinates (x, y, z) for map locations
- **Item** (`core/Item.h`) - Base class for all game items with attributes
- **Tile** (`core/Tile.h`) - Map tile containing items, creatures, spawns
- **Map** (`core/map/Map.h`) - Main map data structure

### Brush System
- **Brush Framework** (`core/brush/`) - Modular painting tools
- **BrushIntegrationManager** - Coordinates brush operations
- **Material System** - Defines brush behaviors and auto-bordering

### Editor Logic
- **EditorController** - Central command coordinator
- **Command Pattern** - Undo/redo system using Qt's command framework
- **Selection System** - Handles area and object selection

### UI Architecture
- **MainWindow** - QMainWindow-based main application window
- **MapView** - OpenGL-based map viewport with navigation
- **Dock System** - Palette panels and tool windows
- **Dynamic Menus** - XML-driven menu system

## Development Workflow

### Task Management
1. **Read** `MASTER_PROJECT_PROMPT.md` for complete workflow
2. **Check** `tasks_execution_order.md` for task dependencies
3. **Review** individual YAML files in `enhanced_wbs_yaml_files/` for specific tasks
4. **Follow** the Kanban board workflow described in project documentation

### Build System
```bash
# Configure build
cmake -B build -S Project_QT

# Build application
cmake --build build

# Run tests
ctest --test-dir build
```

### CMake Integration
- **Qt6 Components**: Core, Gui, Widgets, OpenGL, Concurrent
- **Qlementine**: Integrated as subdirectory with `oclero::qlementine` target
- **Cross-platform**: Windows (WIX), macOS (Bundle/DMG), Linux (DEB/RPM)

## Coding Standards & Best Practices

### Memory Management
- Use **smart pointers** (`std::unique_ptr`, `std::shared_ptr`) over raw pointers
- Prefer **RAII** for resource management
- Use **Qt containers** (`QList`, `QMap`) where appropriate for Qt integration

### Code Organization
- **Namespace**: All new code in `RME` namespace with sub-namespaces
- **Headers**: Use `#pragma once` for include guards
- **Forward Declarations**: Minimize header dependencies
- **Interface Segregation**: Use interfaces like `IItemTypeProvider` to decouple components

### Qt6 Specific
- **Signals/Slots**: Use new syntax `connect(sender, &Class::signal, receiver, &Class::slot)`
- **Resource System**: Use Qt resources for assets (`:/path/to/resource`)
- **Settings**: Use `QSettings` for configuration persistence
- **XML Parsing**: Use `QXmlStreamReader` for XML processing

### Testing
- **Qt Test Framework**: All new code should have unit tests
- **Mock Objects**: Use mocks for external dependencies
- **Test Data**: Store test data in `src/tests/data/`

## Migration Guidelines

### From wxWidgets to Qt6
- **wxString** becomes **QString**
- **wxPoint/wxSize** becomes **QPoint/QSize**
- **wxVector** becomes **QList** or **std::vector**
- **wxMap** becomes **QMap** or **std::map**
- **wxFrame** becomes **QMainWindow**
- **wxPanel** becomes **QWidget**
- **wxSizer** becomes **QLayout** subclasses

### Global Dependencies
- **Avoid global variables** - use dependency injection or service locators
- **Interface-based design** - define interfaces for external data providers
- **Settings integration** - use `AppSettings` class for configuration

## External Dependencies

### Required Libraries
- **Qt6** (6.8.0+) - Core framework
- **Qlementine** - Modern styling (MIT license)
- **pugixml** - XML parsing (bundled)
- **zlib** - OTBM decompression

### Legacy Dependencies (being replaced)
- **wxWidgets** - Original UI framework
- **Boost.Asio** - Network operations (being ported to Qt Network)
- **SFML** - Graphics (being replaced with Qt OpenGL)

## File Naming Conventions

### Source Files
- **Headers**: `.h` extension
- **Implementation**: `.cpp` extension
- **Qt UI Files**: `.ui` extension
- **Qt Resources**: `.qrc` extension

### Directory Structure
- **CamelCase** for class names and files
- **lowercase** for directories
- **Descriptive names** reflecting functionality

## Common Patterns

### Command Pattern (Undo/Redo)
```cpp
class SomeCommand : public QUndoCommand {
public:
    void undo() override;
    void redo() override;
};
```

### Service Integration
```cpp
// Use interfaces to avoid tight coupling
class SomeClass {
    IItemTypeProvider* m_itemProvider;
public:
    void setItemProvider(IItemTypeProvider* provider);
};
```

### Qt Resource Usage
```cpp
// Load from Qt resources
QFile file(":/data/menubar.xml");
```

## Debugging & Development Tools

### Recommended Tools
- **Qt Creator** - Primary IDE with excellent Qt integration
- **CMake Tools** - For build system management
- **Qt Designer** - For UI file editing
- **Doxygen** - API documentation generation

### Debug Configuration
- **Debug builds** include additional validation
- **Memory debugging** available with appropriate CMake flags
- **Qt logging** categories for component-specific debugging

## Performance Considerations

### Rendering
- **OpenGL viewport** for hardware-accelerated map rendering
- **Texture atlases** for efficient sprite rendering
- **Level-of-detail** system for large maps

### Memory
- **Smart pointer usage** to prevent leaks
- **Lazy loading** for large datasets
- **Efficient containers** for frequently accessed data

## Integration Notes

### Qlementine Styling
```cpp
// Initialize Qlementine resources
oclero::qlementine::initializeResources();

// Apply Qlementine style
app.setStyle(new oclero::qlementine::QlementineStyle);
```

### XML Configuration
- **Dynamic menus** loaded from `menubar.xml`
- **Material definitions** in XML format
- **Client version** configurations in XML

## Known Issues & Limitations

### Current State
- **Partial migration** - not all features ported yet
- **Placeholder implementations** - some methods are stubs
- **Testing coverage** - unit tests being developed alongside features

### Migration Priorities
1. **Core data structures** (Position, Item, Tile)
2. **Basic UI framework** (MainWindow, menus)
3. **Map rendering** (OpenGL viewport)
4. **Brush system** (painting tools)
5. **Advanced features** (networking, complex tools)

## Task Management System

### Workflow Overview
- **AI Coder (Jules)** implements features based on YAML task definitions
- **Human Auditor** reviews and approves completed work
- **Kanban Board** tracks task status in `PROJECT_KANBAN_BOARD.md`

### Task Categories
- **BUILD-XX** - Build system and packaging
- **CORE-XX** - Core data structures and logic
- **UI-XX** - User interface components
- **LOGIC-XX** - Editor logic and commands
- **BRUSH-LOGIC-XX** - Specific brush implementations
- **RENDER-XX** - Rendering and graphics
- **NET-XX** - Networking and live collaboration
- **TEST-XX** - Unit and integration tests
- **FINAL-XX** - Integration and polish tasks

### Current Status
- **Completed**: 19 tasks including core data structures, basic UI, and brush framework
- **In Review**: 6 tasks including spawn system, complex items, and editor controller
- **Backlog**: 60+ tasks remaining for full feature parity

## Development Guidelines

### Code Quality Requirements
1. **M1: Scope Adherence** - Implement only what's specified in task YAML
2. **M2: Completeness** - Provide functional, tested code with error handling
3. **M3: Code Location** - Place code in appropriate `Project_QT/src/` subdirectories
4. **M4: Qt6/C++ Best Practices** - Use modern C++17 and Qt6 idioms
5. **M5: Reference Original Code** - Use wxWidgets code as behavioral reference
6. **M6: Modularity** - Create appropriately sized, focused classes
7. **M7: Dependency Management** - Use CMake for component dependencies
8. **M8: Testing** - Provide unit tests for non-trivial logic

### Communication Patterns
- **DESIGN_CHOICE:** - Document significant architectural decisions
- **CODE_CHANGE_SUMMARY:** - Summarize implementation changes
- **CLARIFICATION_REQUEST:** - Request guidance on ambiguous requirements
- **TASK_COMPLETE:** - Signal completion for review

---

*This guide should be updated as the migration progresses and new patterns emerge.*