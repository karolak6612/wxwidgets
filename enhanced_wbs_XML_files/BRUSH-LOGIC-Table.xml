<?xml version="1.0" ?>
<BRUSH-LOGIC-Table>
  <id>BRUSH-LOGIC-Table</id>
  <section>Editor Behavior &amp; Logic</section>
  <title>Port Table Brush Logic</title>
  <original_input_files>
    <original_input_file>wxwidgets/table_brush.cpp</original_input_file>
    <original_input_file>wxwidgets/table_brush.h</original_input_file>
  </original_input_files>
  <analyzed_input_files>
    <analyzed_input_file>
      <file_path>wxwidgets/table_brush.h</file_path>
      <description>Defines 'TableBrush' (inherits 'Brush'). Includes structures for 'TableType' (item ID and chance) and 'TableNode' for different alignments.</description>
    </analyzed_input_file>
    <analyzed_input_file>
      <file_path>wxwidgets/table_brush.cpp</file_path>
      <description>Implements 'TableBrush'. Handles loading definitions from XML. 'doTables' method calculates and applies the correct table segment based on adjacent table pieces.</description>
    </analyzed_input_file>
  </analyzed_input_files>
  <dependencies>
    <dependencie>CORE-BRUSH-FRAMEWORK</dependencie>
    <dependencie>CORE-01</dependencie>
    <dependencie>CORE-02</dependencie>
    <dependencie>LOGIC-01</dependencie>
    <dependencie>CORE-04</dependencie>
    <dependencie>CORE-14-MaterialSystem</dependencie>
  </dependencies>
  <current_functionality_summary>The 'TableBrush' draws table-like items, automatically selecting the correct segment (vertical, horizontal, ends, alone) based on adjacent table pieces. Definitions are loaded from XML.
</current_functionality_summary>
  <qt6_migration_steps>1. Define `mapcore::TableBrush` class inheriting from `mapcore::Brush`.
2. Store current table brush definition (item IDs for alignments) loaded from `MaterialManager`.
3. Implement `apply()`:
   - If erasing: Remove table item. Trigger updates for neighbors.
   - If drawing: Implement 'doTables' logic: Analyze neighbors to select correct table segment item ID. Place item.
   - Record changes for undo.
</qt6_migration_steps>
  <definition_of_done>- `mapcore::TableBrush` is implemented.
- Table brush definitions are loaded and used.
- Auto-alignment logic correctly places table segments.
- Operations are undoable.
- Unit tests for table placement and alignment pass.
</definition_of_done>
  <boilerplate_coder_ai_prompt>Port `TableBrush` from `wxwidgets/table_brush.cpp/h` to `mapcore::TableBrush`.
1. Header: `mapcore::TableBrush : public mapcore::Brush`. Store current table definition (from `MaterialManager`).
2. Source: Implement `apply()`. Core logic is similar to `CarpetBrush` or `WallBrush` - check neighbors to determine which table segment item ID to use from the definition. Place/remove item. All changes via `EditorControllerInterface`.
</boilerplate_coder_ai_prompt>
  <documentation_references>
    <documentation_reference>mapcore::Brush</documentation_reference>
    <documentation_reference>CORE-14-MaterialSystem</documentation_reference>
    <documentation_reference>mapcore::Tile</documentation_reference>
    <documentation_reference>mapcore::Item</documentation_reference>
  </documentation_references>
  <estimation_effort>Large</estimation_effort>
</BRUSH-LOGIC-Table>
