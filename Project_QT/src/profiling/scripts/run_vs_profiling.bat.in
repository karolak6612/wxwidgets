@echo off
REM Visual Studio Profiling Script for RME-Qt6 REFACTOR-02
REM Generated by CMake

echo ========================================
echo  RME-Qt6 Visual Studio Profiling Setup
echo  REFACTOR-02 Implementation
echo ========================================

set EXECUTABLE_PATH=@CMAKE_BINARY_DIR@\bin\profiling\rme_profiling_target.exe
set WORKING_DIR=@CMAKE_BINARY_DIR@

echo Executable: %EXECUTABLE_PATH%
echo Working Directory: %WORKING_DIR%
echo.

REM Check if executable exists
if not exist "%EXECUTABLE_PATH%" (
    echo ERROR: Profiling executable not found!
    echo Please build the project first with:
    echo   cmake --build build --target rme_profiling_target
    pause
    exit /b 1
)

echo Available profiling scenarios:
echo   --startup          : Application startup scenario
echo   --ui               : UI creation scenario  
echo   --memory           : Memory stress scenario
echo   --cpu              : CPU intensive scenario
echo   --profile-scenarios: All scenarios
echo   --interactive      : Interactive mode
echo.

echo Visual Studio Profiling Instructions:
echo 1. Open Visual Studio
echo 2. Go to Debug ^> Performance Profiler
echo 3. Select "Executable" as target
echo 4. Browse to: %EXECUTABLE_PATH%
echo 5. Set Working Directory to: %WORKING_DIR%
echo 6. Choose profiling tools:
echo    - CPU Usage (for performance bottlenecks)
echo    - Memory Usage (for memory leaks/usage)
echo    - .NET/C++ Heap (for detailed memory analysis)
echo 7. Add command line arguments (optional):
echo    --profile-scenarios --duration 60
echo 8. Click "Start" to begin profiling
echo.

echo Alternatively, run directly with:
echo "%EXECUTABLE_PATH%" --profile-scenarios --duration 30
echo.

REM Ask user what to do
echo What would you like to do?
echo [1] Run profiling target directly (30 seconds)
echo [2] Run profiling target interactively
echo [3] Open Visual Studio (manual setup required)
echo [4] Exit
echo.

set /p choice="Enter your choice (1-4): "

if "%choice%"=="1" (
    echo Running profiling scenarios for 30 seconds...
    cd /d "%WORKING_DIR%"
    "%EXECUTABLE_PATH%" --profile-scenarios --duration 30
    pause
) else if "%choice%"=="2" (
    echo Running profiling target in interactive mode...
    echo Use Visual Studio Performance Profiler to attach and analyze
    cd /d "%WORKING_DIR%"
    "%EXECUTABLE_PATH%" --interactive
) else if "%choice%"=="3" (
    echo Opening Visual Studio...
    start devenv.exe
    echo Please follow the manual setup instructions above
    pause
) else if "%choice%"=="4" (
    echo Exiting...
    exit /b 0
) else (
    echo Invalid choice. Exiting...
    exit /b 1
)